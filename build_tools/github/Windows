# Get the Python version of the base image from a build argument
ARG PYTHON_VERSION
FROM winamd64/python:$PYTHON_VERSION-windowsservercore

ARG WHEEL_NAME
ARG CONFTEST_NAME
ARG CIBW_TEST_REQUIRES

# Copy and install the Windows wheel
COPY $WHEEL_NAME $WHEEL_NAME
COPY $CONFTEST_NAME $CONFTEST_NAME
RUN if [[ "$CIBW_PRERELEASE_PYTHONS" == "True" ]]; then \
  export PIP_EXTRA_INDEX_URL=https://pypi.anaconda.org/scientific-python-nightly-wheels/simple; \
  export PIP_PRE=1; \
fi;
RUN pip install $env:WHEEL_NAME

# Install the testing dependencies
RUN pip install $env:CIBW_TEST_REQUIRES.split(" ")
