# Get the Python version of the base image from a build argument
ARG PYTHON_VERSION
FROM winamd64/python:$PYTHON_VERSION-windowsservercore

ARG WHEEL_NAME
ARG CONFTEST_NAME
ARG CIBW_TEST_REQUIRES
ARG PIP_EXTRA_INDEX_URL

# Copy and install the Windows wheel
COPY $WHEEL_NAME $WHEEL_NAME
COPY $CONFTEST_NAME $CONFTEST_NAME
RUN echo PIP_EXTRA_INDEX_URL = $env:PIP_EXTRA_INDEX_URL
# TODO: Remove when 3.11 for scipy images will be available on pypa
RUN echo $env:PYTHON_VERSION
RUN if ($env:PYTHON_VERSION -match '3.11') {python -m pip install scipy==1.10.0.dev0}
RUN pip install $env:WHEEL_NAME

# Install the testing dependencies
RUN pip install $env:CIBW_TEST_REQUIRES.split(" ")
