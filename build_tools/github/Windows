# Get the Python version of the base image from a build argument
ARG PYTHON_VERSION
FROM winamd64/python:$PYTHON_VERSION-windowsservercore

ARG CIBW_TEST_REQUIRES
ARG WHEEL_NAME

# Install the requirements
RUN pip install --upgrade pip
RUN pip install $env:CIBW_TEST_REQUIRES.split(" ")
RUN pip install --upgrade certifi

# Copy and install the Windows wheel
COPY $WHEEL_NAME $WHEEL_NAME
RUN pip install $env:WHEEL_NAME

CMD [ "powershell", "-NoProfile", "-Command", "pytest --pyargs sklearn ; python -m threadpoolctl -i sklearn" ]
